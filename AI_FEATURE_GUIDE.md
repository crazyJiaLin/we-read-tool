# AI整理笔记功能使用指南

## 功能概述

AI整理笔记功能是一个智能化的笔记分析工具，能够自动分析您的读书笔记，按主题分类整理，并提供个性化的学习建议。

## 主要特性

### 🎯 智能分类
- 自动识别笔记主题
- 按内容相关性分组
- 支持多维度分类

### 🔗 关联分析
- 发现笔记间的联系
- 识别知识脉络
- 构建知识体系

### 💡 学习建议
- 个性化复习建议
- 知识应用指导
- 学习计划制定

### 📊 统计概览
- 笔记数量统计
- 书籍分布分析
- 阅读偏好分析

## 使用方法

### 1. 准备工作

确保您已经：
- 设置了微信读书Cookie
- 加载了笔记数据
- 配置了OpenAI API密钥（可选）

### 2. 启动AI整理

1. 在笔记页面点击"AI整理"按钮
2. 系统会自动收集所有笔记数据
3. 调用AI接口进行分析处理
4. 生成整理报告

### 3. 查看结果

AI整理结果包含：

#### 统计信息
- **总笔记数**: 所有笔记的数量
- **涉及书籍**: 笔记来源的书籍数量
- **划线笔记**: 高亮标记的笔记数量
- **个人笔记**: 手动添加的笔记数量

#### 整理内容
- **主题分类**: 按内容主题分组
- **核心观点**: 每个主题的关键要点
- **关联分析**: 笔记间的联系和关联
- **学习建议**: 个性化的学习指导

## 技术实现

### 后端处理流程

1. **数据收集**: 从微信读书API获取笔记数据
2. **数据预处理**: 清理和格式化笔记内容
3. **AI分析**: 调用OpenAI API进行智能分析
4. **结果生成**: 生成结构化的整理报告

### AI提示词设计

系统使用精心设计的提示词来指导AI分析：

```
请帮我整理和分析以下读书笔记，要求：

1. 按主题分类整理笔记
2. 总结每个主题的核心观点
3. 找出笔记之间的联系和关联
4. 提供知识体系建议
5. 给出复习和应用建议

请用结构化的方式输出，包括：
- 主题分类
- 核心观点总结
- 知识关联分析
- 学习建议
```

### 错误处理

- **API不可用**: 当Moonshot API不可用时，系统会返回模拟的整理结果
- **网络错误**: 自动重试机制，确保功能可用性
- **数据异常**: 优雅处理异常数据，保证系统稳定

## 配置说明

### Moonshot配置

在 `.env` 文件中配置：

```bash
# Moonshot API密钥
MOONSHOT_API_KEY=your_moonshot_api_key_here

# 模型选择
MOONSHOT_MODEL=moonshot-v1-8k
```

### 可选配置

```typescript
// 在 config.default.ts 中可以调整
moonshot: {
  apiKey: process.env.MOONSHOT_API_KEY || '',
  apiEndpoint: 'https://api.moonshot.cn/v1/chat/completions',
  model: 'moonshot-v1-8k',
  maxTokens: 2000,        // 最大输出长度
  temperature: 0.7,       // 创造性程度
}
```

## 测试验证

### 运行测试

```bash
# 在后端目录下运行
npm run test:ai
```

### 测试内容

测试脚本会：
1. 使用模拟笔记数据
2. 调用AI整理接口
3. 验证返回结果格式
4. 检查统计信息准确性

## 性能优化

### 响应时间优化
- 异步处理大量笔记
- 智能缓存机制
- 分批处理数据

### 成本控制
- 限制API调用频率
- 优化提示词长度
- 提供模拟数据备选

## 常见问题

### Q: AI整理功能需要付费吗？
A: 如果配置了Moonshot API密钥，会消耗API调用额度。如果没有配置，系统会返回模拟结果。

### Q: 整理结果可以保存吗？
A: 目前整理结果仅在当前会话中显示，建议手动保存重要内容。

### Q: 支持哪些语言？
A: 目前主要支持中文笔记的整理和分析。

### Q: 可以自定义整理规则吗？
A: 可以通过修改AI提示词来调整整理规则和输出格式。

## 未来计划

- [ ] 支持笔记导出功能
- [ ] 添加更多AI模型选择
- [ ] 实现整理结果持久化
- [ ] 支持多语言笔记分析
- [ ] 添加个性化设置选项

## 技术支持

如果您在使用过程中遇到问题，可以：

1. 检查网络连接
2. 验证API配置
3. 查看控制台错误信息
4. 提交Issue反馈问题

---

*AI整理功能旨在帮助您更好地管理和利用读书笔记，让知识更有条理，学习更有效率。* 